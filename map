<div class="trim_screen">
	<h1 class="page_title">Centre Map</h1>
	<select class="mapper" id="store_select_container">
		
	    <script id="store_select_template" type="x-tmpl-mustache/text">
	        {{#sel}}
	        <option selected>Select a Store</option>
	        {{/sel}}
	        
            <option value="{{x_coordinate}},{{y_coordinate}},{{id}}" data-value="{{name}}">{{name}}</option>
        </script>
	</select>
	<div id="parent_div">
		<div id="zoom_container"  >
			<img alt="Aberdeen_directory_map_for_web" id="map_image" src="https://www.mallmaverick.com/system/properties/maps/000/000/029/original/Aberdeen_Directory_Map_for_Web.jpg?1458229826" />
			<div class="landmarks" data-show-at-zoom="100" data-allow-drag="true"></div>
		</div>
	</div>
</div>
<script src="//kodekloud.s3.amazonaws.com/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/jquery.smoothZoom.min.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var stores = getStoresList();
            renderStoreList('#store_select_container','#store_select_template', stores, "stores");
            $( ".mapper" ).prepend( "<option disabled selected>Select a Store</option>" );

            
            $("#map_image").attr("src", getPNGMapURL())
        		$('#map_image').smoothZoom({
        		    width: 840,
                    height: 500,
        		    initial_ZOOM: 0,
        			zoom_MIN: 0,
        			zoom_MAX: 300,
        			responsive: true,
        		    responsive_maintain_ratio: true,
        			zoom_BUTTONS_SHOW : 'YES',
        			pan_BUTTONS_SHOW : 'NO',
        			pan_LIMIT_BOUNDARY : 'NO',
        			button_SIZE: 34,
        			button_ALIGN: "top right",
        			zoom_OUT_TO_FIT: "NO",
        			container: 'zoom_container'
        		});
        	show_png_pin(".mapper", "#map_image");
        }
        loadMallDataCached(renderAll); 
        
        function show_png_pin(trigger, map){
            $(trigger).bind("change", function(e) {
                e.preventDefault()
                
                var selectedOption = $("select.mapper").val().split(",");
                var selectedOptionName = $(".mapper option:selected").text();
                
                var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) );
                // coords = $(selectedOption).attr('data-value').split(",");
                var zoomData = $(map).smoothZoom('getZoomData');
                x_coord = parseInt(selectedOption[0]) + 5;
                y_coord = parseInt(selectedOption[1]);
            
                $(map).smoothZoom('removeLandmark')
                if (isMobile) {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:200});    
                } else {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:150});
                }
                
                $(map).smoothZoom('addLandmark', 
        			[
        			'<div class="item mark" data-show-at-zoom="0" data-position="' + x_coord + ',' + y_coord + '">\
        				<div>\
        					<div class="text">\
        					<strong>'+ selectedOptionName + '</strong>\
        				</div>\
        				<img src="//codecloud.cdn.speedyrails.net/sites/54cfab316e6f6433ad020000/530d3a9b7bc13ce4a511089c23463f99/10dundas_pin.png" width="40px" height="59px" alt="marker" />\
        				</div>\
        			</div>'
        			]
        		);
            });
        }
    })
</script>